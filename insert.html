<!DOCTYPE html>
<html lang="pt-br">
<meta charset="UTF-8">
<title>Mowe Upload API - Insert</title>
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
<script src="dist/js/villa.min.js"></script>
<link rel="stylesheet" href="dist/css/villa.min.css"/>
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="dist/css/material-colors.css"/>
<link rel="stylesheet" type="text/css" href="dist/css/villa-cross.min.css"/>
<script src="dist/js/html5shiv.js"></script>
<script src="dist/js/html5shiv-printshiv.js"></script>
<script src="dist/js/classList.min.js"></script>
<![endif]-->

<body>

<h3>Cadastro de informações</h3>

<span id="erro" style="color: red;"></span>
<input type="text" name="firstname" id="firstname" placeholder="Insira o primeiro"><br>
<input type="text" name="lastname" id="lastname" placeholder="Insira o segundo"><br>
<input type="text" name="age" id="age" placeholder="Insira a idade"/><br>
<p>Selecione:</p>
<input type="radio" name="gender" id="male" value="m" /> <label for="male">male</label>
<input type="radio" name="gender" id="female" value="f" /> <label for="female">female</label><br>
<input type="file" name="file" id="file" placeholder="Insira os arquivos" multiple="true"/><br>

<button id="btn">Call API!</button>

<script>

	var btn = document.getElementById('btn');

	btn.addEventListener('click', function (ev) {

		var erro = document.getElementById('erro');
		var firstname = document.getElementById('firstname');
		var lastname = document.getElementById('lastname');

		if (!firstname.value.length) {
			firstname.focus();
			alert('Informe um nome');
			return;
		} else {
			firstname = firstname.value;
		}

		var age = document.getElementById('age');

		if (age.value != parseInt(age.value, 10)) { // if age.value is int base 10
			age.focus();
			alert('Informe uma idade válida');
			return;
		} else {
			age = age.value;
		}

		if (!document.querySelector("input[name='gender']:checked")) {
			alert("Selecione um genero");
			return;
		} else {
			var genderValue = document.querySelector("input[name='gender']:checked").value;
		}

		var filesValue = document.getElementById('file').files;

		if (!filesValue.length) {
			alert("Selecione um arquivo");
			return;
		}

		// POST request through ajax (without jquery)
		var formData = new FormData();
		formData.append("firstname", firstname);
		if (lastname.value.length) {
			lastname = lastname.value;
			formData.append("lastname", lastname);
		}
		formData.append("age", age);
		formData.append("gender", genderValue);
		for (var i = 0; i < filesValue.length; i++)
			formData.append("file[" + i + "]", filesValue[i]);

		var ajaxReq = new XMLHttpRequest();
		ajaxReq.open("POST", "http://localhost/upload-api/api/insert.php");
		ajaxReq.send(formData);
		ajaxReq.onload = function () {
			if (ajaxReq.status >= 200 && ajaxReq.status < 400) {
				try {
					console.log(ajaxReq.responseText);
				} catch (ex) {
					console.log("Error parse: " + ex);
				}
			} else {
				console.log("erro");
			}
		};
	});

</script>

</body>

</html>